<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Study Plan - Forgot Password</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="css/style.css">
</head>

<body class="d-flex justify-content-center align-items-center vh-100 bg-light">

<div class="card shadow p-4" style="width: 400px;">
    <h4 class="text-center mb-3">Reset Password</h4>
    <p class="text-center small mb-3">Enter your email to reset your password.</p>

    <form id="emailForm">
        <div class="mb-3">
            <label class="form-label"><b>Email</b></label>
            <input type="email" id="resetEmail" class="form-control" placeholder="Enter email" required>
        </div>

        <p id="emailMsg" class="small"></p>

        <button type="submit" class="btn btn-primary w-100 mb-2">Next</button>
        <a href="login.html" class="btn btn-outline-secondary w-100">Back to Login</a>
    </form>

    <form id="resetForm" class="mt-3 d-none">
        <div class="mb-3">
            <label class="form-label"><b>New Password</b></label>
            <input type="password" id="newPass" class="form-control" placeholder="Enter new password" required>
        </div>

        <div class="mb-3">
            <label class="form-label"><b>Confirm Password</b></label>
            <input type="password" id="confirmPass" class="form-control" placeholder="Confirm password" required>
        </div>

        <p id="resetMsg" class="small"></p>

        <button type="submit" class="btn btn-success w-100">Reset Password</button>
        <a href="login.html" class="btn btn-outline-secondary w-100 mt-2">Back to Login</a>
    </form>

</div>

<script>
document.addEventListener("DOMContentLoaded", function(){

    document.getElementById("emailForm").addEventListener("submit", function(e){
        e.preventDefault();

        const enteredEmail = document.getElementById("resetEmail").value.trim();
        const users = JSON.parse(localStorage.getItem("users")) || [];

        const userIndex = users.findIndex(u => u.email === enteredEmail);

        if(userIndex !== -1){
            document.getElementById("emailMsg").innerText = "";

            document.getElementById("emailForm").classList.add("d-none");
            document.getElementById("resetForm").classList.remove("d-none");

            localStorage.setItem("resetUserIndex", userIndex);

        } else {
            document.getElementById("emailMsg").innerText = "No registered account found!";
            document.getElementById("emailMsg").classList.add("text-danger");
        }
    });

    document.getElementById("resetForm").addEventListener("submit", function(e){
        e.preventDefault();

        const newPass = document.getElementById("newPass").value;
        const confirmPass = document.getElementById("confirmPass").value;

        if(newPass !== confirmPass){
            document.getElementById("resetMsg").innerText = "Passwords do not match!";
            document.getElementById("resetMsg").classList.add("text-danger");
            return;
        }

        const users = JSON.parse(localStorage.getItem("users")) || [];
        const index = localStorage.getItem("resetUserIndex");

        if(index !== null){
            users[index].password = newPass; 
            localStorage.setItem("users", JSON.stringify(users));
            localStorage.removeItem("resetUserIndex");

            document.getElementById("resetMsg").innerText = "Password successfully updated!";
            document.getElementById("resetMsg").classList.remove("text-danger");
            document.getElementById("resetMsg").classList.add("text-success");

            setTimeout(() => {
                window.location.href = "login.html";
            }, 1500);
        }
    });

});
</script>

</body>
</html>